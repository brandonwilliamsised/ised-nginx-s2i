worker_processes 1;

events {
    worker_connections 1024;
}

http {
    
    sendfile on;
    
    server {
        server_name dev.ised-isde.canada.ca;
        listen 8080;
        
        gzip on;
        
        location / {
            proxy_pass         http://drupal-wxt.drupal-dev.svc:8080;
            include            /opt/app-root/etc/nginx.d/proxy.conf
        }
        
        location /app/ciposs/agents {
            proxy_pass         http://ciposs-agents-web.ciposs-agents-dev.svc:8080;
            include            /opt/app-root/etc/nginx.d/proxy.conf
        }
        
        location ~ /eic/(.*)$ {
            return 301 https://www.ic.gc.ca/eic/$1?$args;
        }

        location ~ /utils/(.*)$ {
            return 301 https://www.ic.gc.ca/utils/$1?$args;
        }
        
    }
    
    server {
        server_name uat.ised-isde.canada.ca;
        listen 8080;
        
        gzip on;
        
        location / {
            proxy_pass         http://drupal-wxt.drupal-uat.svc:8080;
            include            /opt/app-root/etc/nginx.d/proxy.conf
        }
        
        location /app/ciposs/agents {
            proxy_pass         http://ciposs-agents-web.ciposs-agents-uat.svc:8080;
            include            /opt/app-root/etc/nginx.d/proxy.conf
        }
        
        location ~ /eic/(.*)$ {
            return 301 https://www.ic.gc.ca/eic/$1?$args;
        }

        location ~ /utils/(.*)$ {
            return 301 https://www.ic.gc.ca/utils/$1?$args;
        }
        
    }
    
    server {
        server_name qa.ised-isde.canada.ca;
        listen 8080;
        
        gzip on;
        
        location / {
            proxy_pass         http://drupal-wxt.drupal-qa.svc:8080;
            include            /opt/app-root/etc/nginx.d/proxy.conf
        }
        
        location /app/ciposs/agents {
            proxy_pass         http://ciposs-agents-web.ciposs-agents-qa.svc:8080;
            include            /opt/app-root/etc/nginx.d/proxy.conf
        }
        
        location ~ /eic/(.*)$ {
            return 301 https://www.ic.gc.ca/eic/$1?$args;
        }

        location ~ /utils/(.*)$ {
            return 301 https://www.ic.gc.ca/utils/$1?$args;
        }
        
    }
}
